#!/bin/bash

# author: Thato Semoko
# email: thatosmk@gmail.com

# options are either 'new' or 'open'
if [ $1 == "new" ]; then 

	# create a new directory and cd into it
	mkdir $3 && cd $3

	# create a git repo
	git init 
	
	if [ $2 == "blank" ]; then 
		# copy in a template(main.tex and makefile)
		cp /etc/appa/blank/* .

	elif [ $2 == "science" ]; then 
		# copy in a template(main.tex and makefile)
		cp /etc/appa/science/* .

	fi

	# must also indicate whether the required document is a lab 
	# report or just a document like for minutes or something.
	# for reports follow the IMDRC scheme in a tex/intro.tex, 
	# tex/method.tex ... and include that in a main.tex

	# run make for the pdf file 
	make
	# also clean up before adding to the repo
	# add and make your initial commit
	make clean
 	git add * && git commit -am "added project files"


elif [ $1 == "open" ]; then 

	# check if a git repo exists
	if [ -d .git ]; then 

			# check if the staging branch exists
			exists=`git show-ref refs/heads/staging`

			if [ -n "$exists" ]; then
					# checkout into a new branch and open a file
					git checkout -b staging 
			else
					git checkout staging 
			fi
	fi

fi

# open the pdf file
xdg-open main.pdf 

# run the latexmk in a new terminal  
gnome-terminal -x sh -c "latexmk -pvc -pdf main.tex; zsh"

# open vi with the tex file
vi main.tex
